{"version":3,"sources":["Game.js"],"names":["initSocket","require","cc","Class","extends","Component","properties","board","default","type","Node","players","audiences","userId","isPlayer","isOffline","currentRole","winner","winArray","onLoad","getComponent","game","node","on","addUser","removeUser","socket","updateStepInfo","msg","data","payload","start","indexOf","push","splice","console","log","hasWined","role","hasWinnber"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar initSocket = require('./initSocket')\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    // foo: {\r\n    //     // ATTRIBUTES:\r\n    //     default: null,        // The default value will be used only when the component attaching\r\n    //                           // to a node for the first time\r\n    //     type: cc.SpriteFrame, // optional, default is typeof default\r\n    //     serializable: true,   // optional, default is true\r\n    // },\r\n    // bar: {\r\n    //     get () {\r\n    //         return this._bar;\r\n    //     },\r\n    //     set (value) {\r\n    //         this._bar = value;\r\n    //     }\r\n    // },\r\n\r\n    // board引用\r\n    board: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n    // 前两个player\r\n    // 暂时约定player[0]为黑棋，player[1]为白棋，之后添加角色分配以及交换等机制\r\n    players: [],\r\n    audiences: [],\r\n    userId: null,\r\n    // 区分player和audience\r\n    isPlayer: false,\r\n    isOffline: false,\r\n    // 轮次，和turn对应，1代表黑棋，-1代表白棋\r\n    currentRole: null,\r\n    winner: null,\r\n    winArray: null\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad () {\r\n    // board中注册game引用\r\n    this.board.getComponent('Board').game = this\r\n\r\n    // socket relevant event bind\r\n    // user加入\r\n    this.node.on('join', ({ userId, isPlayer, players }) => {\r\n      this.addUser(userId, players, isPlayer)\r\n    })\r\n\r\n    // user离开\r\n    this.node.on('leave', ({ userId, players, isPlayer }) => {\r\n      this.removeUser(userId, players, isPlayer)\r\n    })\r\n\r\n    // socket init\r\n    initSocket(this)\r\n\r\n    // this.socket is available\r\n    this.socket.on('message', msg => {\r\n      this.board.getComponent('Board').updateStepInfo(msg.data.payload)\r\n    })\r\n  },\r\n\r\n  start () {\r\n\r\n  },\r\n\r\n  // update (dt) {},\r\n\r\n  // 如果player暂时离开，再次加入需要恢复角色\r\n  addUser (userId, players, isPlayer) {\r\n    this.players = players\r\n\r\n    // 如果已经注册了userId，return\r\n    if (this.userId) return\r\n\r\n    // 新user注册userId\r\n    this.userId = userId\r\n    if (isPlayer) {\r\n      // add player\r\n      this.isPlayer = true\r\n      // add role\r\n      // 需要调整, ui允许用户选择和变更role\r\n      this.currentRole = this.players.indexOf(userId) === 0 ? 1 : -1\r\n    } else {\r\n      // add audience\r\n      return this.audiences.push(userId)\r\n    }\r\n    // console.log(this.currentRole)\r\n  },\r\n  // 如果player暂时离开，角色空留，待下次进入\r\n  removeUser (userId, players, isPlayer) {\r\n    this.players = players\r\n    if (isPlayer) {\r\n      this.isOffline = true\r\n    } else {\r\n      this.audiences.splice(this.audiences.indexOf(userId), 1)\r\n    }\r\n    console.log(this.players)\r\n  },\r\n  hasWined (role, winArray) {\r\n    this.winner = role\r\n    this.winArray = winArray\r\n  },\r\n  hasWinnber () {\r\n    return this.winner !== null\r\n  }\r\n})\r\n"]}