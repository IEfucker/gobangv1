{"version":3,"sources":["initSocket.js"],"names":["initSocket","game","log","console","socket","window","io","query","room","userId","Math","random","transports","on","id","msg","node","emit","action","players","users","clients","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;;AAEA,SAASA,UAAT,CAAqBC,IAArB,EAA2B;AACzB,MAAMC,MAAMC,QAAQD,GAApB;;AAEA,MAAME,SAASC,OAAOC,EAAP,CAAU,qBAAV,EAAiC;AAC9C;AACAC,WAAO;AACLC,YAAM,MADD;AAELC,0BAAkBC,KAAKC,MAAL;AAFb,KAFuC;;AAO9CC,gBAAY,CAAC,WAAD;AAPkC,GAAjC,CAAf;;AAUA;;AAEAR,SAAOS,EAAP,CAAU,SAAV,EAAqB,YAAM;AACzB,QAAMC,KAAKV,OAAOU,EAAlB;;AAEAZ,QAAI,WAAJ,EAAiBY,EAAjB,EAAqBV,MAArB;;AAEA;AACAA,WAAOS,EAAP,CAAUC,EAAV,EAAc,eAAO;AACnBZ,UAAI,WAAJ,EAAiBa,GAAjB;AACD,KAFD;AAGD,GATD;;AAWA;AACAX,SAAOS,EAAP,CAAU,QAAV,EAAoB,eAAO;AACzBX,QAAI,UAAJ,EAAgBa,GAAhB;AACA;AACAd,SAAKe,IAAL,CAAUC,IAAV,CAAeF,IAAIG,MAAnB,EAA2B;AACzBC,eAASJ,IAAII,OADY;AAEzBV,cAAQM,IAAIN,MAFa;AAGzBW,aAAOL,IAAIM;AAHc,KAA3B;AAKD,GARD;;AAUA;AACAjB,SAAOS,EAAP,CAAU,YAAV,EAAwB,eAAO;AAC7BX,QAAI,aAAJ,EAAmBa,GAAnB;AACD,GAFD;;AAIAX,SAAOS,EAAP,CAAU,eAAV,EAA2B,YAAM;AAC/BX,QAAI,gBAAJ;AACD,GAFD;;AAIAE,SAAOS,EAAP,CAAU,OAAV,EAAmB,YAAM;AACvBX,QAAI,QAAJ;AACD,GAFD;;AAIAE,SAAOS,EAAP,CAAU,SAAV,EAAqB,eAAO;AAC1BX,QAAI,UAAJ,EAAgBa,GAAhB;AACD,GAFD;;AAIAd,OAAKG,MAAL,GAAcA,MAAd;AACD;AACDkB,OAAOC,OAAP,GAAiBvB,UAAjB","file":"initSocket.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// var io = require('./socket.io')\n// console.log(io, window.io)\n// io = io || window.io\n\nfunction initSocket (game) {\n  const log = console.log\n\n  const socket = window.io('ws://localhost:7001', {\n    // 实际使用中可以在这里传递参数\n    query: {\n      room: 'demo',\n      userId: `client_${Math.random()}`\n    },\n\n    transports: ['websocket']\n  })\n\n  // log(socket)\n\n  socket.on('connect', () => {\n    const id = socket.id\n\n    log('#connect,', id, socket)\n\n    // 监听自身 id 以实现 p2p 通讯\n    socket.on(id, msg => {\n      log('#receive,', msg)\n    })\n  })\n\n  // 接收在线用户信息\n  socket.on('online', msg => {\n    log('#online ', msg)\n    // action = 'join' || 'leave'\n    game.node.emit(msg.action, {\n      players: msg.players,\n      userId: msg.userId,\n      users: msg.clients\n    })\n  })\n\n  // 系统事件\n  socket.on('disconnect', msg => {\n    log('#disconnect', msg)\n  })\n\n  socket.on('disconnecting', () => {\n    log('#disconnecting')\n  })\n\n  socket.on('error', () => {\n    log('#error')\n  })\n\n  socket.on('message', msg => {\n    log('#message', msg)\n  })\n\n  game.socket = socket\n}\nmodule.exports = initSocket\n"]}